{% extends "accounts/accounts_base.html" %}

{% block content %}
<div class="container mx-auto p-6 max-w-2xl">
    <h1 class="text-3xl font-bold mb-6">Request Attendance Correction</h1>
    
    <div class="bg-white shadow rounded-lg p-6">
        <form method="post">
            {% csrf_token %}
            
            <!-- Date Selection -->
            <div class="mb-4">
                <label for="date" class="block text-sm font-medium text-gray-700 mb-2">
                    Date <span class="text-red-500">*</span>
                </label>
                <input 
                    type="date" 
                    id="date" 
                    name="date" 
                    required
                    max="{{ today }}"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                <p class="text-sm text-gray-500 mt-1">Select the date for which you want to request correction</p>
            </div>

            <!-- Status Selection -->
            <div class="mb-4">
                <label for="status" class="block text-sm font-medium text-gray-700 mb-2">
                    Correct Status <span class="text-red-500">*</span>
                </label>
                <select 
                    id="status" 
                    name="status" 
                    required
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                    <option value="">-- Select Status --</option>
                    <option value="PRESENT">Present</option>
                    <option value="ABSENT">Absent</option>
                    <option value="LEAVE">Leave</option>
                </select>
                <p class="text-sm text-gray-500 mt-1">What should your attendance status be for this date?</p>
            </div>

            <!-- Reason -->
            <div class="mb-6">
                <label for="reason" class="block text-sm font-medium text-gray-700 mb-2">
                    Reason for Correction <span class="text-red-500">*</span>
                </label>
                <textarea 
                    id="reason" 
                    name="reason" 
                    rows="4" 
                    required
                    placeholder="Please provide a detailed explanation for why this correction is needed..."
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                ></textarea>
                <p class="text-sm text-gray-500 mt-1">Provide details to help HR review your request</p>
            </div>

            <!-- Buttons -->
            <div class="flex gap-4">
                <button 
                    type="submit"
                    class="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition"
                >
                    Submit Request
                </button>
                <a 
                    href="{% url 'employee_home' %}"
                    class="bg-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-400 transition"
                >
                    Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- View Pending Requests -->
    <div class="bg-white shadow rounded-lg p-6 mt-6">
        <h2 class="text-xl font-bold mb-4">Your Pending Requests</h2>
        
        {% if pending_requests %}
            <div class="space-y-4">
                {% for req in pending_requests %}
                <div class="border-l-4 {% if req.status == 'PENDING' %}border-yellow-500{% elif req.status == 'APPROVED' %}border-green-500{% else %}border-red-500{% endif %} pl-4 py-2">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-semibold">{{ req.date|date:"d M, Y" }}</p>
                            <p class="text-sm text-gray-600">Requested: {{ req.requested_status }}</p>
                            <p class="text-sm text-gray-500 mt-1">{{ req.reason }}</p>
                        </div>
                        <div>
                            {% if req.status == 'PENDING' %}
                                <span class="px-3 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">Pending</span>
                            {% elif req.status == 'APPROVED' %}
                                <span class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-800">Approved</span>
                            {% else %}
                                <span class="px-3 py-1 text-xs rounded-full bg-red-100 text-red-800">Rejected</span>
                            {% endif %}
                        </div>
                    </div>
                    <p class="text-xs text-gray-400 mt-2">Submitted: {{ req.created_at|date:"d M, Y H:i" }}</p>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-gray-500 text-center py-4">No pending requests</p>
        {% endif %}
    </div>
</div>
{% endblock %}